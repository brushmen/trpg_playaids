<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="description" content="a Javascript version of For Lady Blackbird, my hack of Alex Roberts's tRPG For the Queen">
    <meta name="author" content="brushmen">
    <title>For Lady Blackbird Playaid</title>
    <script type="text/javascript" src="scripts/jquery.min.js"></script>
<script>
var instruction_cards = [
    "[BEGIN] Players take turns reading these cards aloud.",
    "Lady Blackbird is a Stormblood sorcerer in the Imperial Worlds. The House of Blackbird was rewarded with wealth and status by the Empress for years of loyal service to the Empire.",
    "However, she turned her back on all of it when she fled on the day of her wedding.",
    "She hired a crew of smugglers to take her on her soul-searching journey, but with an uncertain end.",
    "Wealth and status can no longer assist her as she ventures further from home.",
    "Perhaps you can help her find what she is looking for.",
    "When at last she looks to you for guidance, what do you say to her?",
    "Decide on a play order, then the first player will start with the first prompt card.",
    "Pick an approximate session length to begin the game.",
    /*"Shuffle the prompt cards, and place them facedown.",*/
    /*"Put the \"Lady Blackbird looks to you for guidance\" card in the middle of the deck for an approximately 30 minute game, or into the bottom third of the deck to play for an hour or more.",*/
    "Take turns reading the questions out loud. Interpret these questions, and answer them however you wish.",
    "Other players may ask you questions or make suggestions on your turn, but it's optional whether you answer them and/or incorporate the suggestions.",
    "Use X-card, Script Change, or other safe play methods that's suitable for your group.",
    "If you encounter a card, or an answer, that you don't want to be included in the game, use your preferred safe play method to notify the group, then remove that content from the game.",
    "If you draw a card that is removed this way by yourself or someone else, another prompt will be shown to you.",
    "You can also pass on your turn. To do so, pass the prompt card to the next player, and say: \"I'd like to hear your answer to this question.\"",
    "A prompt card can be passed around until someone chooses to remove it from the game.",
    "Continue answering, passing, and removing questions until the \"Lady Blackbird looks to you for guidance\" card is drawn.",
    "Each player should respond to that prompt in turn. Then, the game is over. [END] Click to read the instruction from the beginning."
];

var setting_cards = [
    "Sorcery is dominated by the nobility in the Imperial Worlds, but how is it regulated to preserve balance of power?",
    "Is the Wild Blue like outer space as we know it, or layers of breathable air above layers of corrosive clouds?",
    "How has advancing technology not over-taken sorcery in this era?",
    "Are floating shard worlds powered by sorcery or technology, or a mix of both?",
    "How close is the Empire to abolishing all forms of slavery for good?",
    "Why has the Empire not yet conquered Haven, a beacon of the Free World?",
    "How are pirate clans regarded by both the Imperial and the Free Worlds?",
    "Do other races beside human exist in this world? What are some of them like?",
    "What do the people know about the creatures in the eternal darkness of the Lower Depth?",
    "What is a prominent color scheme in the Imperial Worlds?",
    "What is a prominent characteristic of architecture in the Free Worlds?"
];

var prompt_cards = [
    /* about one's own character */
    "What is one principle that the Empire champions that you also believe in?",
    "What is the one quality about the Free Worlds that you dislike?",
    "What was the one decision you made that significantly changed your path in life?",
    "What was a major world event that impacted your life?",
    "What great loss did you suffer in the Imperial Worlds?",
    "What great loss did you suffer in the Free Worlds?",
    "What great loss did you suffer in the Lower Depth, where even the toughest skyship will go bust after four hours?",
    "Why do you want to exact revenge on the nobles of the Empire, knowing that Lady Blackbird is one of them?",
    "What was the worst thing you have ever done but will do it again in a heartbeat?",
    "What has been your greatest regret?",
    "What has been your proudest achievement?",

    /* about Lady Blackbird or one's relationship to her */
    "What common belief do you and Lady Blackbird hold?",
    "Which piece of art form that both you and Lady Blackbird love and often bond over?",
    "After finding out her skill with disguises, what would you do or look for to see through her methods?",
    "What skill have you learned from her?",
    "What did Lady Blackbird ask you to teach her? Did you agree? What happened?",
    "What is a belief that you and Lady Blackbird have agreed to disagree on?",
    "Lady Blackbird is a master of disguise. Why did she choose to reveal her identity to you?",
    "What is one thing that Lady Blackbird did that made you respect her regardless of her wealth and status?",
    "Which secret did Lady Blackbird share with no one but you?",
    "Why do you trust her?",
    "Why do you believe Lady Blackbird has the power to change the Empire?",
    "What is something Lady Blackbird does often that annoys you?",
    "What is your one quality that Lady Blackbird can barely tolerate?",
    "What makes you believe that Lady Blackbird has feelings for you? What do you do about it?",
    "Why do you believe you are the best match for her?",
    "What secret you hold that will change Lady Blackbird's opinion of you for the worse?",
    "How does Lady Blackbird attempt to pay you for your help when she cannot access her family's wealth anymore?",
    "What is the scariest thing she has done in your presence?",
    "What did Lady Blackbird shed a tear over when she thought no one was looking?",
    "What is the real reason you are helping her on this journey, other than fulfilling a contract?",
    "What did you sacrifice in order to help her with the journey?",
    "What did she sacrifice in order to help you?",
    "What did she do that makes you start to regret helping her?",
    "What did Lady Blackbird once say to you that opened up an old wound?",
    "What do you admire about Lady Blackbird besides her presence?",
    "Lady Blackbird forgave you for an offense, but when she is frustrated, what does she do that reminds you of the incident?",
    "What is flawed about Lady Blackbird that could end her journey prematurely?",
    "What did you destroy in her presence? How did it affect her?",
    "What did she destroy in your presence? How did it affect you?",
    "You owe Lady Blackird a great debt. What is it and why does she never mention it?",
    "What was the worst thing you know Lady Blackbird did, and that she has never regretted doing?",
    "She once told you a story that you believe is a lie. Why did you not tell her so?",

    /* about relationship to other characters */
    "Who are you most proud of in life?",
    "What skill have you learned from one of her companions?",
    "Why do you think her other traveling companions put up with you?",
    "Why do you think her old flame is not worthy of her?",
    "Who among her companions do you trust the least and why?",
    "Who among her companions do you trust the most and why?",
    "Who among her companions do you owe a favor from?",
    "Who among her companions saved your life on the crime-infested Nightport?",
    "Who among her companions told you a secret about the Empire that not even Lady Blackbird knew about? And what was that secret?",
    "In what way will one of her companions compromise her goal? Why do you think so?",
    "If any of her companions upset you, how do you keep control over your anger?",
    "Who among her companions told you a secret about the Free Worlds that no one else knew about? And what was that secret?",
    "Who among her companions told you a secret about her? And what was that secret?",
    "Who among her companions saw you help someone in Haven? Why did you ask them to keep it a secret?",
    "Who among her companions defended you when she accused you falsely?",
    "One of her companions completely changed your impression of them with a single action. What did they do?"
];

var bodyguard_prompts = [
    "You went from one indentured servitude to a lengthy contract with her. How do you feel about that?",
    "How did you help Lady Blackbird escape the wedding she did not want?",
    "What was the outcome of a sparring match between you and her?",
    "What terms did you ask for in your contract that she refused to agree to?",
    "What promise did you make to someone who helped you back in the days of cage fights?",
    "What was a pleasant memory you have back when you were still landlocked on Ilysium, the capital world of the Empire?"
];

var smuggler_prompts = [
    "Why does the Owl, your raggedy skyship, give you hope?",
    "How did you become an outcast of the Empire?",
    "What is your connection to the Imperial noble clans, knowing your Warpblood is a rare bloodline for teleportation sorcery?",
    "What reputation have you heard of Lady Blackbird or her family when you were still an Imperial soldier?",
    "Who are you still loyal to in the Imperial Worlds? And why?",
    "What was a pleasant memory you have back when you were still serving in Olympia, the naval stronghold of the Empire?"
];

var fixer_prompts = [
    "How do you keep the Owl, the skyship you maintain, in tip-top shape?",
    "Where did your skills with sorcery come from?",
    "What is the one thing you should never have stolen?",
    "Why did you never join a crime syndicate on the darkside of Nightport, when they offered you a much richer lifestyle?",
    "What is your relationship with theft?",
    "What do you keep going back to on Nightport, where natural light can never reach?"
];

var skysailor_prompts = [
    "How does the Owl, the skyship you pilot, remind you of home?",
    "Despite being known as a dare-devil in the Wild Blue, deep down what are you afraid of the most?",
    "Why did you never join a pirate clan when they offered a much freer lifestyle?",
    "What was a cool story you keep telling others about the Lower Depth?",
    "Why did you become a pilot?"
];

var betrothed_prompts = [
    "How did you convince the person who abandoned you to let you join her travels?",
    "What was the primary reason for the arranged marriage between you and Lady Blackbird?",
    "What did you think of her before the marriage ceremony?",
    "How much harm has her refusal to marry you brought to your clan's or your own reputation?",
    "How do you really feel when she left you at the altar?",
    "How do you plan to convince her to come home?"
];

var oldflame_prompts = [
    "How did your old flame not turn you away when you became part of her crew?",
    "How did the two of you fall in love?",
    "How did the two of you become separated?",
    "Do you still love her as you used to?",
    "How has she changed since you last saw her?",
    "How have you changed since you two were last together?"
];

var confidant_prompts = [
    "You two led very divergent lives. Why are you now with her on this journey?",
    "Where did the two of you first meet?",
    "How did you stay in touch over the years?",
    "What do you remember fondly of her before she left the Imperial Worlds?",
    "What is something you confided in her that strengthened your bond?",
    "What is the biggest change you saw in her over the years?"
];

var custom_prompts = [
    "What made her agree to take you along on her journey?",
    "What is your connection to the House of Blackbird?",
    "What important task was assigned to you with regard to Lady Blackbird?",
    "Why do you want to bring her home?",
    "What secret do you know of Lady Blackbird that could ruin her?",
    "What nickname do you have for her?"
];

var end_card = [
    "Lady Blackbird looks to you for guidance. What do you say to her?",
];

var deck;
var characters;

function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}

function play(minutes=30) {
    playOrder();
    if ($("#skipsettingprompts").prop('checked')) {
        // skip setting prompts by emptying that deck
        setting_cards = new Array();
    } else {
        // shuffle the setting prompts
        setting_cards = shuffle(setting_cards);
    }
    // remove that section from the user interface
    $("#worldbuilding").hide();

    gameLength(minutes);

    // display the top card for the first character
    displayCard();
    updateCardOptions();
}

function playOrder() {
    var char = "";
    var val;

    characters = new Array();

    // if custom character has a play order but no name
    // give default name
    char = $("input[name='customcharacter']").val();
    if (!char) {
        char = "(custom)";
    }
    $("input[name='customcharacter']").parent().html(char);

    $("input[name='playorder']").each(function() {
        // only picked characters have play order
        val = $(this).val();
        if ($.isNumeric(val)) {
            char = $(this).parent().prev().html().trim();
            characters[char] = val;
        }
    });

    // sort the characters by play order
    // convert to tuple, then back to regular array
    var tuples = [];
    for (var key in characters) tuples.push([key, characters[key]]);

    tuples.sort(function(a, b) {
        a = a[1];
        b = b[1];

        return a < b ? -1 : (a > b ? 1 : 0);
    });

    characters = new Array();
    for (var i = 0; i < tuples.length; i++) {
        var key = tuples[i][0];
        var value = tuples[i][1];

        characters[i] = key;
    }

    if (characters.length == 0) {
        characters.push("(you)"); // default option
    }

    updateCharacters();
}

function updateCharacters() {
    var html = "";

    for (var key in characters) {
        if (key == 0) {
            html += "<div id=\"currentchar\">🡆&nbsp;&nbsp;" + characters[key] + "</div>";
        } else {
            html += "<div>" + characters[key] + "</div>";
        }
    }

    $("#characters").html(html);
}

function gameLength(minutes=30) {
    var numcards;
    var tempdeck;

    deck = new Array();
    tempdeck = shuffle(prompt_cards);

    // don't play with every card
    if (minutes == 30) {
        numcards = 20;
    } else if (minutes == 60) {
        numcards = 30;
    } else {
        numcards = 40;
    }

    // can't play more than the deck size
    if (numcards > tempdeck.length) {
        numcards = tempdeck.length;
    }

    // copy from general prompt cards up to numcards
    for (var i = 0; i < numcards; i++) {
        deck.push(tempdeck[i]);
    }
    deck.push(end_card);

    // shuffle the character-specific decks and
    // discard all but 2
    numcards = 2;

    for (var j = 0; j < characters.length; j++) {
        if (characters[j] == "bodyguard") {
            bodyguard_prompts = shuffle(bodyguard_prompts);
            bodyguard_prompts = bodyguard_prompts.slice(0, numcards);
        } else if (characters[j] == "smuggler") {
            smuggler_prompts = shuffle(smuggler_prompts);
            smuggler_prompts = smuggler_prompts.slice(0, numcards);
        } else if (characters[j] == "fixer") {
            fixer_prompts = shuffle(fixer_prompts);
            fixer_prompts = fixer_prompts.slice(0, numcards);
        } else if (characters[j] == "sky-sailor") {
            skysailor_prompts = shuffle(skysailor_prompts);
            skysailor_prompts = skysailor_prompts.slice(0, numcards);
        } else if (characters[j] == "betrothed") {
            betrothed_prompts = shuffle(betrothed_prompts);
            betrothed_prompts = betrothed_prompts.slice(0, numcards);
        } else if (characters[j] == "old flame") {
            oldflame_prompts = shuffle(oldflame_prompts);
            oldflame_prompts = oldflame_prompts.slice(0, numcards);
        } else if (characters[j] == "confidant") {
            confidant_prompts = shuffle(confidant_prompts);
            confidant_prompts = confidant_prompts.slice(0, numcards);
        } else {
            custom_prompts = shuffle(custom_prompts);
            custom_prompts = custom_prompts.slice(0, numcards);
        }
    }
}

function updateCardOptions() {
    var html = "";

    if (deck.length > 0) {
        html += "<div id=\"\">OPTIONS<br/><br/>";

        html += "<a href=\"#\" onclick=\"drawCard();\">Next Prompt</a><br/><br/>";
        if (characters.length > 1) {
            html += "<a href=\"#\" onclick=\"passCard();\">Pass</a><br/><br/>";
        }
        html += "<a href=\"#\" onclick=\"removeCard();\">Remove</a><br/><br/>";

        html += "</div>";
    }
    else if (characters.length > 1) {
        html += "<div id=\"\">FINAL ROUND<br/><br/>";
        html += "<a href=\"#\" onclick=\"nextCharacter();\">Next Player</a><br/><br/><br/><br/>";
        html += "<a href=\"#\" onclick=\"window.location.reload(false);\">Start New Game</a>?";
        html += "</div>";
    }

    $("#cardoptions").html(html);
}

function drawCard() {
    nextCharacter();
    displayCard();
}

function displayCard() {
    var html = "";

    // go through setting prompts first if not skipping

    if (setting_cards.length > 0) {
        html = setting_cards.shift();
    }

    else {

        // first draw from character-specific decks
        // first character is current character
        if (characters[0] == "bodyguard") {
            if (bodyguard_prompts.length > 0) {
                // also remove the card from deck
                html = bodyguard_prompts.shift();
            }
            else {
                // also remove the card from deck
                html = deck.shift();
            }

        } else if (characters[0] == "smuggler") {
            if (smuggler_prompts.length > 0) {
                // also remove the card from deck
                html = smuggler_prompts.shift();
            }
            else {
                // also remove the card from deck
                html = deck.shift();
            }
        } else if (characters[0] == "fixer") {
            if (fixer_prompts.length > 0) {
                // also remove the card from deck
                html = fixer_prompts.shift();
            }
            else {
                // also remove the card from deck
                html = deck.shift();
            }
        } else if (characters[0] == "sky-sailor") {
            if (skysailor_prompts.length > 0) {
                // also remove the card from deck
                html = skysailor_prompts.shift();
            }
            else {
                // also remove the card from deck
                html = deck.shift();
            }
        } else if (characters[0] == "betrothed") {
            if (betrothed_prompts.length > 0) {
                // also remove the card from deck
                html = betrothed_prompts.shift();
            }
            else {
                // also remove the card from deck
                html = deck.shift();
            }
        } else if (characters[0] == "old flame") {
            if (oldflame_prompts.length > 0) {
                // also remove the card from deck
                html = oldflame_prompts.shift();
            }
            else {
                // also remove the card from deck
                html = deck.shift();
            }
        } else if (characters[0] == "confidant") {
            if (confidant_prompts.length > 0) {
                // also remove the card from deck
                html = confidant_prompts.shift();
            }
            else {
                // also remove the card from deck
                html = deck.shift();
            }
        } else {
            if (custom_prompts.length > 0) {
                // also remove the card from deck
                html = custom_prompts.shift();
            }
            else {
                // also remove the card from deck
                html = deck.shift();
            }
        }
    }

    // display card in main area
    $("#prompt").html(html);
    updateCardOptions();
}

function nextCharacter() {
    if (characters.length > 0) {
        // move current player to end of list
        var c = characters.shift();
        characters.push(c);
        updateCharacters();
    }
}

function passCard() {
    // highlight next player
    nextCharacter();
}

function removeCard() {
    // draw new card instead without passing to next
    displayCard();
}

function instructions() {
    // loop instruction cards

    var html = "<b>instructions</b><br/><br/>";
    var c = instruction_cards.shift();
    html += "<a href=\"#\" onclick=\"instructions();\">" + c + "</a>";

    $("#instructions").html(html);

    instruction_cards.push(c);
}
</script>
<style>
body {
    font-size: 62.5%; /* 1em = 10px */
    font-family: Sans-Serif;
    background-color: #8eb0d6;
}

#character {
    width: 300px;
    margin: auto;
    padding: 1em;
    font-size: 2em;
    color: #1c1108;
    background-color: #969188;
}

#currentchar {
    padding: 0.5em;
    color: #969188;
    background-color: #441b11;
}

#prompt {
    width: 600px;
    margin: auto;
    padding: 2em;
    font-size: 4em;
    background-color: #dcd1a7;
}

#cardoptions {
    padding-top: 1em;
    font-size: 1.4em;
}

table[id="characters"] td {
    padding: 0.3em;
    text-align: center;
}

input[name="playorder"] {
    width: 30px;
}

#instructions {
    width: 250px;
    margin-top: 3em;
    padding: 2em;
    font-size: 1.6em;
    background-color: #d4e4ee;
}
#instructions a {
    text-decoration: none;
}
#instructions a:link,
#instructions a:visited,
#instructions a:hover {
    border-bottom: 1px dashed navy;
}
</style>
</head>
<body>
<table width="100%">
<tr><td valign="top">
    <div id="character">
        <table id="characters">
        <tr><th>
            <b>characters</b>
        </th><th>
            <b>play order</b>
        </th></tr>
        <tr><td>
            bodyguard
        </td><td>
            <input type="text" name="playorder" />
        </td></tr>
        <tr><td>
            smuggler
        </td><td>
            <input type="text" name="playorder" />
        </td></tr>
        <tr><td>
            fixer
        </td><td>
            <input type="text" name="playorder" />
        </td></tr>
        <tr><td>
            sky-sailor
        </td><td>
            <input type="text" name="playorder" />
        </td></tr>
        <tr><td>
            betrothed
        </td><td>
            <input type="text" name="playorder" />
        </td></tr>
        <tr><td>
            old flame
        </td><td>
            <input type="text" name="playorder" />
        </td></tr>
        <tr><td>
            confidant
        </td><td>
            <input type="text" name="playorder" />
        </td></tr>
        <tr><td>
            <input type="text" name="customcharacter" size="16" placeholder="(custom)" />
        </td><td>
            <input type="text" name="playorder" />
        </td></tr>
        </table>
        <br/>
        <table id="worldbuilding">
            <tr><td>
                <input type="checkbox" id="skipsettingprompts" />🡄 Skip the first 10 prompts about the setting?
            </td></tr>
        </table>
    </div>
</td><td valign="top">
    <div id="prompt">
        <div style="line-height: 20pt;">
        <span style="font-size:30pt;">For Lady Blackbird</span>
    <span style="font-size: 16pt;">is a group storytelling game where each player answers prompt about Lady Blackbird and a character they play. Everyone takes turns and builds on previous answers to flesh out the Lady and their characters. It is inspired by John Harper's <a href="http://onesevendesign.com/ladyblackbird/">Lady Blackbird</a>.
    <br/><br/>
    This work is based on <a href="http://www.forthequeengame.com/">For the Queen</a>, product of Alex Roberts and Evil Hat Productions, and licensed for our use under the <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported license</a>.
    <br/><br/>
    Thanks to Diana Moon for valuable feedback.
    </span>
    </div>
</div>
</td>
<td valign="top" width="250">
<div id="cardoptions">
Session Length:<br/><br/>
<a href="#" onclick="play(30);">~30 minutes</a><br/><br/>
<a href="#" onclick="play(60);">~1 hour</a><br/><br/>
<a href="#" onclick="play(120);">~2 hours</a>
</div>
<div id="instructions"><a href="#" onclick="instructions();">instructions</a></div>
</td>
</tr>
</table>
</body>
</html>
