<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="description" content="Quill (solo RPG) Playaid written in Javascript">
  <meta name="author" content="brushmen">
  <title>Quill Playaid</title>
  <script language="javascript">
    var p1score = 0;
    var p2score = 0;
    var p3score = 0;
    var p4score = 0;
    var p5score = 0;
    var total = 0;
    var skill = "";
    var p1scored = false;
    var p2scored = false;
    var p3scored = false;
    var p4scored = false;
    var p5scored = false;
    var skillused = false;

    function useSkill() {
      var s = document.getElementById("skill");
      skill = s.options[s.selectedIndex].value;
      s = document.getElementById("useskill");
      // skill can only be used once, so disable the button after click
      s.disabled = true;
    }

    function test(source, flourish) {
      var a = document.getElementById("attributes");
      a = a.options[a.selectedIndex].value;
      var b = document.getElementById("bonus");
      b = b.options[b.selectedIndex].value;
      var pdice = 0;
      var ldice = 0;
      var hdice = 0;

      switch(a) {
        case "p1l2h3":
          pdice = 1;
          ldice = 2;
          hdice = 3;
          break;
        case "p1l3h2":
          pdice = 1;
          ldice = 3;
          hdice = 2;
          break;
        case "p2l1h3":
          pdice = 2;
          ldice = 1;
          hdice = 3;
          break;
        case "p2l3h1":
          pdice = 2;
          ldice = 3;
          hdice = 1;
          break;
        case "p3l1h2":
          pdice = 3;
          ldice = 1;
          hdice = 2;
          break;
        case "p3l2h1":
          pdice = 3;
          ldice = 2;
          hdice = 1;
          break;
        default:
          pdice = 1;
          ldice = 1;
          hdice = 1;
          break;
      }

      switch (b) {
        case "p":
          pdice += 1;
          break;
        case "l":
          ldice += 1;
          break;
        case "h":
          hdice += 1;
          break;
      }

      if ((skill) && (!skillused)) {
        switch (skill) {
          case "p":
            pdice += 1;
            break;
          case "l":
            ldice += 1;
            break;
          case "h":
            hdice += 1;
            break;
        }
        skillused = true;
      }

      var block = document.getElementById(source);
      block.innerHTML = "";

      var fbonus = 0;
      if (flourish) {
          block.innerHTML += "Flourish ";
          if (testSuccess(hdice)) {
            block.innerHTML += "passes; ";
            fbonus = 1;
          }
          else {
            block.innerHTML += "fails; ";
          }
      }

      var score = 0;

      block.innerHTML += "Word choice ";
      if (testSuccess(ldice)) {
        block.innerHTML += "superior; ";
        score += 1;
        score += fbonus;
      }
      else {
        block.innerHTML += "inferior; ";
        score -= fbonus;
      }

      block.innerHTML += "Penmanship ";
      if (testSuccess(pdice)) {
        block.innerHTML += "passes. ";
        score += 1;
      }
      else {
        block.innerHTML += "fails. ";
      }

      // calculate paragraph's score
      switch (source) {
        case "b1":
          p1score = score;
          p1scored = true;
          break;
        case "b2":
          p2score = score;
          p2scored = true;
          break;
        case "b3":
          p3score = score;
          p3scored = true;
          break;
        case "b4":
          p4score = score;
          p4scored = true;
          break;
        case "b5":
          p5score = score;
          p5scored = true;
          break;
      }

      // check if all paragraph has score, total up if yes
      if ((p1scored) && (p2scored) && (p3scored) && (p4scored) && (p5scored)) {
        total = p1score + p2score + p3score + p4score + p5score;

        // update score section
        var e = document.getElementById("b6");
        e.innerHTML = "Total Score: " + total + " - ";
        if (total < 5) e.innerHTML += "The letter is poorly received.";
        else if (total < 8) e.innerHTML += "The letter has a tepid reception.";
        else if (total < 11) e.innerHTML += "The letter is well received.";
        else e.innerHTML += "The letter has an excellent reception.";

        e.innerHTML += "&nbsp;&nbsp;<button type='button' onclick='fullLetter()'>full letter</button"; 
      }
    }

    function testSuccess(numdice) {
      var result = false;

      while (numdice > 0) {
        if (rollDie() > 4) {
            result = true;
            break;
        }
        numdice--;
      }

      return result;
    }

    function rollDie(sides) {
      if(!sides) sides = 6;
      with(Math) return 1 + floor(random() * sides);
    }

    function fullLetter() {
      var e = document.getElementById("letter");
      var p0 = document.getElementById("p0").value;
      var p1 = document.getElementById("p1").value;
      var p2 = document.getElementById("p2").value;
      var p3 = document.getElementById("p3").value;
      var p4 = document.getElementById("p4").value;
      var p5 = document.getElementById("p5").value;
      var p6 = document.getElementById("p6").value.replace(/\n/g, "<br>");

      e.innerHTML = "<div class='fullletter'>" + p0 +
                    "<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + p1 +
                    "<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + p2 +
                    "<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + p3 +
                    "<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + p4 +
                    "<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + p5 +
                    "<br/><br/>" + p6 + "<br/><br/></div>";
    }
  </script>

  <style>
    body {
      width: 100%;
      margin: 0;
      background-color: #fef5e7;
      font-size: 62.5%; /* 1em = 10px */
      font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;
    }

    #letter {
      margin: 20px 20px 20px 60px;
      font-size: 2em;
    }
    .fullletter{
      padding: 20px 20px 20px 60px;
      background-color: #fdebd0;
      border-width: 0 1px 1px 0;
      border-color: black;
      border-style: solid;
    }

    #p0, #p1, #p2, #p3, #p4, #p5, #p6 {
      background-color: #fdebd0;
      font-size: 1.4em;
      width: 500px;
      margin-left: 50px;
      color: #1c2833;
      vertical-align: middle;
    }
    #p1, #p2, #p3, #p4, #p5 {
      height: 150px;
    }
    #p0 {
      margin-top: 20px;
      height: 70px;
    }
    #p6 {
      margin-bottom: 20px;
      height: 100px;
    }

    #b1,#b2,#b3,#b4,#b5,#b6 {
      width: 350px;
    }

    #inkpot {
      width: 20%;
      height: 90%;
      background-color: #1c2833;
      color: white;
      font-size: 2.2em;
      position: fixed;
      top: 3%;
      right: 1%;
      z-index: 100;
    }

    #credit {
      position: fixed;
      bottom: 1%;
      right: 5%;
    }
  </style>
</head>

<body>
  <table id="letter" width="70%">
    <tr><td><textarea id="p0" placeholder="Salutation..."></textarea></td>
        <td width="550">
          <table>
          <tr><td colspan="3">
          <select id="attributes">
            <option value="p1l2h3">Penmanship 1, Language 2, Heart 3</option>
            <option value="p1l3h2">Penmanship 1, Language 3, Heart 2</option>
            <option value="p2l1h3">Penmanship 2, Language 1, Heart 3</option>
            <option value="p2l3h1">Penmanship 2, Language 3, Heart 1</option>
            <option value="p3l1h2">Penmanship 3, Language 1, Heart 2</option>
            <option value="p3l2h1">Penmanship 3, Language 2, Heart 1</option>
          </select>
          </td></tr>
          <tr><td>
          <select id="bonus">
            <option value="">No Bonus</option>
            <option value="p">+1 Penmanship</option>
            <option value="l">+1 Language</option>
            <option value="h">+1 Heart</option>
          </select>
          </td><td>
          <select id="skill">
            <option value="">No Skill</option>
            <option value="p">+1 Penmanship</option>
            <option value="l">+1 Language</option>
            <option value="h">+1 Heart</option>
          </select>
          </td><td>
          <button id="useskill" type="button" onclick="useSkill()">use skill</button>
          </td></tr>
          </table>
        </td></tr>
    <tr><td><textarea id="p1" placeholder="Paragraph 1..."></textarea></td>
    <td>
          <div id="b1">
              <button type="button" onclick="test('b1', true)">try FLOURISH</button>
              <button type="button" onclick="test('b1', false)">no flourish</button>
          </div>
      </td></tr>
    <tr><td><textarea id="p2" placeholder="Paragraph 2..."></textarea></td>
    <td>
        <div id="b2">
            <button type="button" onclick="test('b2', true)">try FLOURISH</button>
            <button type="button" onclick="test('b2', false)">no flourish</button>
        </div>
      </td></tr>
      <tr><td><textarea id="p3" placeholder="Paragraph 3..."></textarea></td>
      <td>
        <div id="b3">
            <button type="button" onclick="test('b3', true)">try FLOURISH</button>
            <button type="button" onclick="test('b3', false)">no flourish</button>
        </div>
      </td></tr>
      <tr><td><textarea id="p4" placeholder="Paragraph 4..."></textarea></td>
      <td>
        <div id="b4">
            <button type="button" onclick="test('b4', true)">try FLOURISH</button>
            <button type="button" onclick="test('b4', false)">no flourish</button>
        </div>
      </td></tr>
      <tr><td><textarea id="p5" placeholder="Paragraph 5..."></textarea></td>
      <td>
        <div id="b5">
            <button type="button" onclick="test('b5', true)">try FLOURISH</button>
            <button type="button" onclick="test('b5', false)">no flourish</button>
        </div>
      </td></tr>
      <tr><td><textarea id="p6" placeholder="Closing..."></textarea></td>
    <td>
        <div id="b6"></div>
    </td></tr>
    </table>

    <textarea id="inkpot" placeholder="INKPOT:&#10;&#10;(paste in list of words in the below format)&#10;&#10;Inferior/Superior&#10;Inferior/Superior"></textarea>

  <div id="credit">
    <a href="https://www.drivethrurpg.com/product/170400/Quill-A-LetterWriting-Roleplaying-Game-for-a-Single-Player" target="new">Scott Malthouse's <i>Quill</i></a>
  </div>
</body>
</html>
